<!DOCTYPE html>
<html lang="zh-cn" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>AdaSPEC: Selective Knowledge Distillation for Efficient Speculative Decoders | JJ&#39;s Blog</title>
<meta name="keywords" content="Speculative Decoding, Paper Note">
<meta name="description" content="
Conference: NeurIPS&#39;25 Spotlight
Github: https://github.com/yuezhouhu/adaspec

My Thoughts
è¿™ç¯‡è®ºæ–‡çš„ methods æŒºç®€æ˜çš„ï¼Œæ„Ÿè§‰å¯ä»¥æœ‰ä¸ªæ–° idea:
å°† MoSD å’Œ AdaSPEC ç»“åˆèµ·æ¥ â€”â€” é’ˆå¯¹ä¸åŒéš¾åº¦çš„ tokens distill å‡ºä¸åŒçš„ draft modelsï¼Œåˆ©ç”¨ router å°†ä¸åŒéš¾åº¦çš„ tokens é€‰æ‹©æœ€é€‚åˆçš„å¯¹åº” draft model æ¥è¿›è¡Œ SDã€‚
é—®é¢˜åœ¨äºï¼šå¯¹äºè®ºæ–‡ä¸­æåˆ°çš„â€œhard tokensâ€ï¼Œæ˜¯å¦èƒ½ distill å‡ºä¸€ä¸ªåˆé€‚ä¸”æœ‰ç”¨çš„ draft modelï¼Ÿ
è®ºæ–‡ç»“æœæ˜¾ç¤ºå½“å‰æ–¹æ³•å¯¹è¿™äº› token æ•ˆæœè¾ƒå·®ï¼ˆç”šè‡³æ¯” reference model è¿˜å·®ï¼‰ï¼Œ  å› æ­¤éœ€è¦æ–°çš„æ–¹å¼æ¥æ”¹è¿›è¿™ä¸€éƒ¨åˆ†çš„è’¸é¦ä¸åˆ©ç”¨æœºåˆ¶ã€‚

1. Motivation
Speculative Decoding (SD) accelerates large language model inference by employing a small draft model to generate predictions, which are then verified by a larger target model.">
<meta name="author" content="">
<link rel="canonical" href="https://jjl357.github.io/blog/posts/adaspec---selective-knowledge-distillation-for-efficient-speculative-decoders---neurips25-spotlight/">
<link crossorigin="anonymous" href="https://jjl357.github.io/blog/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://jjl357.github.io/blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jjl357.github.io/blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://jjl357.github.io/blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://jjl357.github.io/blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://jjl357.github.io/blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh-cn" href="https://jjl357.github.io/blog/posts/adaspec---selective-knowledge-distillation-for-efficient-speculative-decoders---neurips25-spotlight/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><script type="text/javascript"
        async
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
<meta property="og:url" content="https://jjl357.github.io/blog/posts/adaspec---selective-knowledge-distillation-for-efficient-speculative-decoders---neurips25-spotlight/">
  <meta property="og:site_name" content="JJ&#39;s Blog">
  <meta property="og:title" content="AdaSPEC: Selective Knowledge Distillation for Efficient Speculative Decoders">
  <meta property="og:description" content="
Conference: NeurIPS&#39;25 Spotlight
Github: https://github.com/yuezhouhu/adaspec
My Thoughts è¿™ç¯‡è®ºæ–‡çš„ methods æŒºç®€æ˜çš„ï¼Œæ„Ÿè§‰å¯ä»¥æœ‰ä¸ªæ–° idea:
å°† MoSD å’Œ AdaSPEC ç»“åˆèµ·æ¥ â€”â€” é’ˆå¯¹ä¸åŒéš¾åº¦çš„ tokens distill å‡ºä¸åŒçš„ draft modelsï¼Œåˆ©ç”¨ router å°†ä¸åŒéš¾åº¦çš„ tokens é€‰æ‹©æœ€é€‚åˆçš„å¯¹åº” draft model æ¥è¿›è¡Œ SDã€‚
é—®é¢˜åœ¨äºï¼šå¯¹äºè®ºæ–‡ä¸­æåˆ°çš„â€œhard tokensâ€ï¼Œæ˜¯å¦èƒ½ distill å‡ºä¸€ä¸ªåˆé€‚ä¸”æœ‰ç”¨çš„ draft modelï¼Ÿ
è®ºæ–‡ç»“æœæ˜¾ç¤ºå½“å‰æ–¹æ³•å¯¹è¿™äº› token æ•ˆæœè¾ƒå·®ï¼ˆç”šè‡³æ¯” reference model è¿˜å·®ï¼‰ï¼Œ å› æ­¤éœ€è¦æ–°çš„æ–¹å¼æ¥æ”¹è¿›è¿™ä¸€éƒ¨åˆ†çš„è’¸é¦ä¸åˆ©ç”¨æœºåˆ¶ã€‚
1. Motivation Speculative Decoding (SD) accelerates large language model inference by employing a small draft model to generate predictions, which are then verified by a larger target model.">
  <meta property="og:locale" content="zh-cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-10-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-27T00:00:00+00:00">
    <meta property="article:tag" content="Speculative Decoding">
    <meta property="article:tag" content="Paper Note">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AdaSPEC: Selective Knowledge Distillation for Efficient Speculative Decoders">
<meta name="twitter:description" content="
Conference: NeurIPS&#39;25 Spotlight
Github: https://github.com/yuezhouhu/adaspec

My Thoughts
è¿™ç¯‡è®ºæ–‡çš„ methods æŒºç®€æ˜çš„ï¼Œæ„Ÿè§‰å¯ä»¥æœ‰ä¸ªæ–° idea:
å°† MoSD å’Œ AdaSPEC ç»“åˆèµ·æ¥ â€”â€” é’ˆå¯¹ä¸åŒéš¾åº¦çš„ tokens distill å‡ºä¸åŒçš„ draft modelsï¼Œåˆ©ç”¨ router å°†ä¸åŒéš¾åº¦çš„ tokens é€‰æ‹©æœ€é€‚åˆçš„å¯¹åº” draft model æ¥è¿›è¡Œ SDã€‚
é—®é¢˜åœ¨äºï¼šå¯¹äºè®ºæ–‡ä¸­æåˆ°çš„â€œhard tokensâ€ï¼Œæ˜¯å¦èƒ½ distill å‡ºä¸€ä¸ªåˆé€‚ä¸”æœ‰ç”¨çš„ draft modelï¼Ÿ
è®ºæ–‡ç»“æœæ˜¾ç¤ºå½“å‰æ–¹æ³•å¯¹è¿™äº› token æ•ˆæœè¾ƒå·®ï¼ˆç”šè‡³æ¯” reference model è¿˜å·®ï¼‰ï¼Œ  å› æ­¤éœ€è¦æ–°çš„æ–¹å¼æ¥æ”¹è¿›è¿™ä¸€éƒ¨åˆ†çš„è’¸é¦ä¸åˆ©ç”¨æœºåˆ¶ã€‚

1. Motivation
Speculative Decoding (SD) accelerates large language model inference by employing a small draft model to generate predictions, which are then verified by a larger target model.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://jjl357.github.io/blog/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "AdaSPEC: Selective Knowledge Distillation for Efficient Speculative Decoders",
      "item": "https://jjl357.github.io/blog/posts/adaspec---selective-knowledge-distillation-for-efficient-speculative-decoders---neurips25-spotlight/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "AdaSPEC: Selective Knowledge Distillation for Efficient Speculative Decoders",
  "name": "AdaSPEC: Selective Knowledge Distillation for Efficient Speculative Decoders",
  "description": "\nConference: NeurIPS'25 Spotlight\nGithub: https://github.com/yuezhouhu/adaspec\nMy Thoughts è¿™ç¯‡è®ºæ–‡çš„ methods æŒºç®€æ˜çš„ï¼Œæ„Ÿè§‰å¯ä»¥æœ‰ä¸ªæ–° idea:\nå°† MoSD å’Œ AdaSPEC ç»“åˆèµ·æ¥ â€”â€” é’ˆå¯¹ä¸åŒéš¾åº¦çš„ tokens distill å‡ºä¸åŒçš„ draft modelsï¼Œåˆ©ç”¨ router å°†ä¸åŒéš¾åº¦çš„ tokens é€‰æ‹©æœ€é€‚åˆçš„å¯¹åº” draft model æ¥è¿›è¡Œ SDã€‚\né—®é¢˜åœ¨äºï¼šå¯¹äºè®ºæ–‡ä¸­æåˆ°çš„â€œhard tokensâ€ï¼Œæ˜¯å¦èƒ½ distill å‡ºä¸€ä¸ªåˆé€‚ä¸”æœ‰ç”¨çš„ draft modelï¼Ÿ\nè®ºæ–‡ç»“æœæ˜¾ç¤ºå½“å‰æ–¹æ³•å¯¹è¿™äº› token æ•ˆæœè¾ƒå·®ï¼ˆç”šè‡³æ¯” reference model è¿˜å·®ï¼‰ï¼Œ å› æ­¤éœ€è¦æ–°çš„æ–¹å¼æ¥æ”¹è¿›è¿™ä¸€éƒ¨åˆ†çš„è’¸é¦ä¸åˆ©ç”¨æœºåˆ¶ã€‚\n1. Motivation Speculative Decoding (SD) accelerates large language model inference by employing a small draft model to generate predictions, which are then verified by a larger target model.\n",
  "keywords": [
    "Speculative Decoding", "Paper Note"
  ],
  "articleBody": "\nConference: NeurIPS'25 Spotlight\nGithub: https://github.com/yuezhouhu/adaspec\nMy Thoughts è¿™ç¯‡è®ºæ–‡çš„ methods æŒºç®€æ˜çš„ï¼Œæ„Ÿè§‰å¯ä»¥æœ‰ä¸ªæ–° idea:\nå°† MoSD å’Œ AdaSPEC ç»“åˆèµ·æ¥ â€”â€” é’ˆå¯¹ä¸åŒéš¾åº¦çš„ tokens distill å‡ºä¸åŒçš„ draft modelsï¼Œåˆ©ç”¨ router å°†ä¸åŒéš¾åº¦çš„ tokens é€‰æ‹©æœ€é€‚åˆçš„å¯¹åº” draft model æ¥è¿›è¡Œ SDã€‚\né—®é¢˜åœ¨äºï¼šå¯¹äºè®ºæ–‡ä¸­æåˆ°çš„â€œhard tokensâ€ï¼Œæ˜¯å¦èƒ½ distill å‡ºä¸€ä¸ªåˆé€‚ä¸”æœ‰ç”¨çš„ draft modelï¼Ÿ\nè®ºæ–‡ç»“æœæ˜¾ç¤ºå½“å‰æ–¹æ³•å¯¹è¿™äº› token æ•ˆæœè¾ƒå·®ï¼ˆç”šè‡³æ¯” reference model è¿˜å·®ï¼‰ï¼Œ å› æ­¤éœ€è¦æ–°çš„æ–¹å¼æ¥æ”¹è¿›è¿™ä¸€éƒ¨åˆ†çš„è’¸é¦ä¸åˆ©ç”¨æœºåˆ¶ã€‚\n1. Motivation Speculative Decoding (SD) accelerates large language model inference by employing a small draft model to generate predictions, which are then verified by a larger target model.\nSD çš„åŠ é€Ÿæ€§èƒ½ä¾èµ–äº draft ä¸ target æ¨¡å‹çš„å¯¹é½åº¦ï¼ˆalignmentï¼‰ã€‚ä¼ ç»Ÿ Knowledge Distillation (KD) çš„ç›®æ ‡æ˜¯æœ€å°åŒ– KL æ•£åº¦ï¼Œä½†è¿™ä¸ SD çš„æœ€ç»ˆç›®æ ‡â€”â€”æœ€å¤§åŒ– token acceptance rateï¼ˆè¢« target æ¥å—çš„æ¯”ä¾‹ï¼‰â€”â€”å¹¶ä¸ä¸€è‡´ã€‚\nå› æ­¤ï¼Œå³ä½¿ KD èƒ½ä½¿åˆ†å¸ƒæ¥è¿‘ï¼Œä¹Ÿä¸ä¸€å®šæå‡ SD çš„å®é™…åŠ é€Ÿæ•ˆæœã€‚\næ ¸å¿ƒé—®é¢˜ï¼š å®¹é‡å—é™ï¼šå° draft æ¨¡å‹æ— æ³•è¡¨è¾¾ target çš„å®Œæ•´åˆ†å¸ƒã€‚ ç›®æ ‡ä¸ä¸€è‡´ï¼šKD ä¼˜åŒ– KLï¼Œè€Œ SD è¿½æ±‚ acceptance rateã€‚ æµªè´¹å­¦ä¹ èµ„æºï¼šdraft æŠŠå®¹é‡æµªè´¹åœ¨é‚£äº›â€œæ— è®ºå¦‚ä½•éƒ½éš¾å­¦â€çš„ hard tokens ä¸Šã€‚ 2. Challenge Conventional KD methods minimize the forward KL divergence between the draft and target models across all tokens:\n$$ \\mathcal{L}{KD} = \\mathbb{E}{x \\sim D},[,\\mathrm{KL}(P_\\text{target}(y|x)|P_\\text{draft}(y|x)),] $$\nç„¶è€Œï¼Œè¿™ç§â€œå¯¹æ‰€æœ‰ token è¿›è¡Œå‡åŒ€è’¸é¦â€çš„ç›®æ ‡å­˜åœ¨ä¸¤å¤§é—®é¢˜ï¼š\nä¸ SD ç›®æ ‡ä¸åŒ¹é…ï¼šSD çš„ç›®æ ‡æ˜¯æœ€å¤§åŒ– acceptance rateï¼Œè€Œä¸æ˜¯å…¨åˆ†å¸ƒ KLã€‚ token å­¦ä¹ éš¾åº¦å·®å¼‚å·¨å¤§ï¼š â€œeasy tokensâ€ å¯ä»¥è¢«å°æ¨¡å‹å¾ˆå¥½åœ°å­¦ä¹ ï¼› â€œhard tokensâ€ æ— è®ºæ€ä¹ˆè®­ç»ƒéƒ½éš¾ä»¥å¯¹é½ã€‚ å› æ­¤ï¼Œdraft æ¨¡å‹è‹¥åœ¨ hard token ä¸Šæµªè´¹å®¹é‡ï¼Œåè€Œå¯èƒ½æŸå®³ easy token çš„æ‹Ÿåˆè´¨é‡ã€‚\n3. Contribution AdaSPEC çš„æ ¸å¿ƒè´¡çŒ®ï¼š\nSelective Token Filteringï¼šåˆ©ç”¨ reference model è¯†åˆ«å¹¶è¿‡æ»¤æ‰ draft éš¾ä»¥å­¦ä¹ çš„ tokensï¼Œä»…å¯¹â€œæ˜“å­¦ tokenâ€æ‰§è¡Œ KDã€‚ Draft Model èµ„æºå†åˆ†é…ï¼šä½¿æœ‰é™å®¹é‡ä¸“æ³¨äºå®¹æ˜“æ‹Ÿåˆçš„åŒºåŸŸï¼Œä»è€Œæ˜¾è‘—æå‡ acceptance rateã€‚ å¹¿æ³›éªŒè¯ï¼šåœ¨ç®—æœ¯æ¨ç†ã€æŒ‡ä»¤è·Ÿéšã€ä»£ç ç”Ÿæˆã€æ‘˜è¦ç”Ÿæˆä»»åŠ¡ä¸Šå‡æ˜¾è‘—ä¼˜äº DistillSpecï¼Œæœ€é«˜æå‡çº¦ 15%ã€‚ 4. Method AdaSPEC çš„è®­ç»ƒè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªä¸»è¦æ­¥éª¤ï¼š\nStep 1: Constructing the Reference Model åˆå§‹åŒ–ï¼šä»¥ draft æ¨¡å‹ç»“æ„ä¸ºåŸºç¡€ï¼Œå¤åˆ¶å…¶å‚æ•°å¾—åˆ° reference model ( M_{\\text{ref}} )ã€‚ è’¸é¦è®­ç»ƒï¼šåˆ©ç”¨ target æ¨¡å‹ ( M_{\\text{tgt}} ) ä½œä¸º teacherï¼Œå¯¹ reference model è¿›è¡Œå¸¸è§„ KDï¼š $$ \\mathcal{L}{ref} = \\mathbb{E}\\big[\\mathrm{KL}(P{\\text{tgt}}(y|x)|P_{\\text{ref}}(y|x))\\big] $$ ç›®æ ‡ï¼šå¾—åˆ°ä¸€ä¸ªå¯¹ target è¡Œä¸ºè¾ƒå¥½æ‹Ÿåˆã€ä½†å®¹é‡ä»æ¥è¿‘ draft çš„ reference æ¨¡å‹ï¼Œç”¨äºè¡¡é‡ token éš¾åº¦ã€‚ Step 2: Selective Knowledge Distillation for the Draft Model åœ¨è®­ç»ƒ draft æ¨¡å‹ ( M_q ) æ—¶ï¼Œå¼•å…¥ selective token filteringï¼š\nå®šä¹‰ token-wise loss å·®å€¼ï¼š\nå¯¹äºæ¯ä¸ª token ( w )ï¼Œè®¡ç®— draft ä¸ reference åœ¨ç›¸å¯¹äº target çš„ KL æŸå¤±ï¼š $$ L_{ref}(w) = \\mathrm{KL}(P_{\\text{tgt}}(w|x)|P_{\\text{ref}}(w|x)) $$ $$ L_{draft}(w) = \\mathrm{KL}(P_{\\text{tgt}}(w|x)|P_{\\text{draft}}(w|x)) $$\nå®šä¹‰å·®å€¼ï¼š $$ \\Delta L(w) = L_{draft}(w) - L_{ref}(w) $$\ntoken é€‰æ‹©ï¼ˆFilteringï¼‰ï¼š\nè®¡ç®—æ¯ä¸ª token çš„ Î”Lï¼Œå¹¶æŒ‰å€¼æ’åºï¼Œä»…ä¿ç•™ top-k%ï¼ˆä¾‹å¦‚ 40%ï¼‰çš„ token å‚ä¸è’¸é¦ï¼š $$ S = { w \\mid \\Delta L(w) \\text{ ä½äºå‰ } k% } $$\nç›´è§‰ï¼š\nè‹¥ Î”L è¾ƒå¤§ â†’ draft å¯¹è¯¥ token ä»æœ‰æ”¹è¿›ç©ºé—´ï¼Œå€¼å¾—å­¦ä¹ ï¼› è‹¥ Î”L è¾ƒå°æˆ–è´Ÿ â†’ token å¤ªéš¾æˆ– draft/ref éƒ½å­¦ä¸å¥½ï¼Œæ— éœ€æµªè´¹å®¹é‡ã€‚ æœ€ç»ˆçš„ selective distillation lossï¼š\nä»…å¯¹é€‰ä¸­çš„ token æ±‚å¹³å‡ï¼š $$ \\mathcal{L}{AdaSPEC} = \\frac{1}{|S|}\\sum{w \\in S} L_{draft}(w) $$\n5. Evaluation 5.1 å®éªŒè®¾ç½® Datasets / Tasksï¼š\nArithmetic reasoning (GSM8K) Instruction-following (Alpaca) Coding (MBPP) Summarization (CNN/DM, XSUM) Model pairsï¼š\nPythia-31M â†’ 1.4B CodeGen-350M â†’ Phi-2 (2.7B) Phi-1.5 â†’ Phi-2 Mixtral-8x7B â†’ Mixtral-8x22B Baselinesï¼š\nDirect KD DistillSpec RKL-based distillation Token filtering ablations (ä¸åŒ filter é˜ˆå€¼) Metricsï¼š\nToken acceptance rate (â†‘) Task accuracy (e.g. pass@1, rouge-L) Speed-up ratio (â†‘) Draft perplexity vs. target perplexity 5.2 ä¸»è¦ç»“æœ Acceptance Rate æ˜¾è‘—æå‡\nå¹³å‡æå‡ 8â€“15%ï¼› åœ¨ 31M â†’ 1.4B çš„æå¤§è§„æ¨¡å·®ä¸‹æ•ˆæœæœ€çªå‡ºï¼› å³ä½¿åœ¨ capacity gap è¾¾ 64Ã— çš„æƒ…å†µä¸‹ï¼Œä»ç»´æŒé«˜ acceptance rateã€‚ Generation Quality æ— æ˜æ˜¾ä¸‹é™\nRouge-Lã€BLEUã€pass@1 ç­‰æŒ‡æ ‡å‡ ä¹ä¿æŒï¼› selective filtering å¹¶æœªå¯¼è‡´è¯­ä¹‰åç§»æˆ–å¥æ³•å¼‚å¸¸ã€‚ Token Filtering çš„æ¯”ä¾‹å½±å“\nè®ºæ–‡å®éªŒæ˜¾ç¤ºå½“è¿‡æ»¤æ¯”ä¾‹åœ¨ 30â€“50% æ—¶æ€§èƒ½æœ€ä¼˜ï¼› è¿‡æ»¤è¿‡å¤šï¼ˆ\u003c20%ï¼‰å¯¼è‡´ä¿¡æ¯ä¸è¶³ï¼Œè¿‡æ»¤è¿‡å°‘ï¼ˆ\u003e60%ï¼‰åˆ™æµªè´¹å®¹é‡ã€‚ Wall-Time Speed-up\nåœ¨ vLLM å®æµ‹ä¸‹å¯è¾¾ 1.2â€“1.4Ã— åŠ é€Ÿï¼› ä¸ EAGLE ç­‰ speculative sampling ç­–ç•¥ç»“åˆå¯è¿›ä¸€æ­¥æå‡ã€‚ 5.3 æ¶ˆèç ”ç©¶ï¼ˆAblationï¼‰ æ— è¿‡æ»¤ï¼ˆFull KDï¼‰ï¼šacceptance rate æœ€ä½ï¼› éšæœºè¿‡æ»¤ï¼šæ— è§„å¾‹æ€§èƒ½ä¸‹é™ï¼› AdaSPEC Filteringï¼šåœ¨ç›¸åŒ loss ä¸‹å¯æ˜¾è‘—æå‡ Î±ï¼› ä¸åŒ KD æŸå¤±ï¼ˆRKL / TVDï¼‰ï¼šforward KL è¡¨ç°æœ€ç¨³å®šã€‚ 6. Discussion 6.1 Size Gap Between Target and Draft Models è®ºæ–‡æŒ‡å‡ºï¼Œåœ¨ä¼ ç»Ÿ SD ä¸­ï¼Œdraft ä¸ target çš„è§„æ¨¡å·®ä¸€èˆ¬ \u003c10Ã—ã€‚ ä½† AdaSPEC é€šè¿‡ selective KDï¼Œå³ä½¿åœ¨ 64Ã— å‚æ•°å·®è·ä¸‹ä»ä¿æŒæ˜¾è‘—æ€§èƒ½æå‡ã€‚\nè§£é‡Šï¼š\nå½“æ¨¡å‹å®¹é‡å·®è·æ‰©å¤§æ—¶ï¼Œç›´æ¥ KD çš„â€œrepresentation mismatchâ€é—®é¢˜æ›´ä¸¥é‡ï¼› AdaSPEC é€šè¿‡èšç„¦äºæ˜“å­¦ tokenï¼Œå‡å°‘äº† mismatch åŒºåŸŸï¼› å› æ­¤æ¨¡å‹å·®è·è¶Šå¤§ï¼ŒAdaSPEC çš„ç›¸å¯¹æ”¶ç›Šè¶Šæ˜æ˜¾ã€‚ 6.2 ä¸ Rho-1 çš„å…³ç³»ï¼ˆLin et al., 2024ï¼‰ Rho-1 (Not All Tokens Are What You Need) å¼ºè°ƒåœ¨é¢„è®­ç»ƒé˜¶æ®µ ä¼˜å…ˆå­¦ä¹  hard tokensï¼›\nAdaSPEC åˆ™ç›¸åï¼šåœ¨ SD ä¸­ æ’é™¤ hard tokensï¼Œèšç„¦äºæ˜“å­¦éƒ¨åˆ†ï¼›\nåŒºåˆ«æºäºç›®æ ‡ä¸åŒï¼š\né¢„è®­ç»ƒå¸Œæœ›æ‰©å±•æ¨¡å‹èƒ½åŠ›ï¼› SD è’¸é¦å¸Œæœ›æœ€å¤§åŒ–å°æ¨¡å‹çš„å®ç”¨æ€§èƒ½ï¼ˆacceptance rateï¼‰ã€‚ 6.3 å±€é™æ€§ä¸æœªæ¥æ–¹å‘ â€œAs a preliminary study on selective training for SD, we limit our study on simple loss-related token filter.â€\nfuture work:\nä¸ tree-based speculative decoding (å¦‚ MoSD) ç»“åˆ 7. Conclusion We present AdaSPEC, a novel approach for training more efficient draft models for Speculative Decoding. AdaSPEC introduces selective token filtering based on reference model perplexity gaps, enabling draft models to focus limited capacity on tokens where alignment with the target model is most achievable.\nHigher acceptance rates across diverse tasks; Significant acceleration without degradation in output quality; Robustness across large model gaps. AdaSPEC ä¸ºå°æ¨¡å‹çš„é«˜æ•ˆæ¨ç†ï¼ˆå°¤å…¶æ˜¯åœ¨ edge / on-device åœºæ™¯ï¼‰æä¾›äº†æ–°çš„è’¸é¦è§†è§’ã€‚ å®ƒå¯å‘æˆ‘ä»¬ï¼šåœ¨æ¨ç†åŠ é€Ÿä»»åŠ¡ä¸­ï¼Œå­¦ä¹ ä»€ä¹ˆæ¯”å­¦å¤šå°‘æ›´é‡è¦ã€‚\n",
  "wordCount" : "640",
  "inLanguage": "zh-cn",
  "datePublished": "2025-10-27T00:00:00Z",
  "dateModified": "2025-10-27T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jjl357.github.io/blog/posts/adaspec---selective-knowledge-distillation-for-efficient-speculative-decoders---neurips25-spotlight/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "JJ's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jjl357.github.io/blog/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
  <nav class="nav">
    <div class="logo">
      
      <a href="https://jjl357.github.io/" accesskey="h" title="ğŸ¥› â˜• ğŸµ (Alt + H)">
        <span>ğŸ¥› â˜• ğŸµ</span>
        
      </a>

      <div class="logo-switches">
        <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
          <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
          <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>
      </div>
    </div>
    <ul id="menu">
    </ul>
  </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      AdaSPEC: Selective Knowledge Distillation for Efficient Speculative Decoders
    </h1>
    <div class="post-meta"><span title='2025-10-27 00:00:00 +0000 UTC'>October 27, 2025</span>

</div>
  </header> 
  <div class="post-content"><p><img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/title.png"></p>
<p><strong>Conference:</strong> <strong>NeurIPS'25 Spotlight</strong><br>
<strong>Github:</strong> <a href="https://github.com/yuezhouhu/adaspec">https://github.com/yuezhouhu/adaspec</a></p>
<hr>
<h2 id="my-thoughts">My Thoughts<a hidden class="anchor" aria-hidden="true" href="#my-thoughts">#</a></h2>
<p>è¿™ç¯‡è®ºæ–‡çš„ methods æŒºç®€æ˜çš„ï¼Œæ„Ÿè§‰å¯ä»¥æœ‰ä¸ªæ–° idea:<br>
<strong>å°† MoSD å’Œ AdaSPEC ç»“åˆèµ·æ¥</strong> â€”â€” é’ˆå¯¹ä¸åŒéš¾åº¦çš„ tokens distill å‡ºä¸åŒçš„ draft modelsï¼Œåˆ©ç”¨ router å°†ä¸åŒéš¾åº¦çš„ tokens é€‰æ‹©æœ€é€‚åˆçš„å¯¹åº” draft model æ¥è¿›è¡Œ SDã€‚</p>
<p>é—®é¢˜åœ¨äºï¼šå¯¹äºè®ºæ–‡ä¸­æåˆ°çš„â€œhard tokensâ€ï¼Œæ˜¯å¦èƒ½ distill å‡ºä¸€ä¸ªåˆé€‚ä¸”æœ‰ç”¨çš„ draft modelï¼Ÿ<br>
è®ºæ–‡ç»“æœæ˜¾ç¤ºå½“å‰æ–¹æ³•å¯¹è¿™äº› token æ•ˆæœè¾ƒå·®ï¼ˆç”šè‡³æ¯” reference model è¿˜å·®ï¼‰ï¼Œ  å› æ­¤éœ€è¦æ–°çš„æ–¹å¼æ¥æ”¹è¿›è¿™ä¸€éƒ¨åˆ†çš„è’¸é¦ä¸åˆ©ç”¨æœºåˆ¶ã€‚</p>
<hr>
<h2 id="1-motivation">1. Motivation<a hidden class="anchor" aria-hidden="true" href="#1-motivation">#</a></h2>
<p>Speculative Decoding (SD) accelerates large language model inference by employing a small <strong>draft model</strong> to generate predictions, which are then verified by a larger <strong>target model</strong>.</p>
<p><img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/figure1.png"></p>
<p>SD çš„åŠ é€Ÿæ€§èƒ½ä¾èµ–äº draft ä¸ target æ¨¡å‹çš„<strong>å¯¹é½åº¦ï¼ˆalignmentï¼‰</strong>ã€‚ä¼ ç»Ÿ Knowledge Distillation (KD) çš„ç›®æ ‡æ˜¯æœ€å°åŒ– KL æ•£åº¦ï¼Œä½†è¿™ä¸ SD çš„æœ€ç»ˆç›®æ ‡â€”â€”<strong>æœ€å¤§åŒ– token acceptance rateï¼ˆè¢« target æ¥å—çš„æ¯”ä¾‹ï¼‰</strong>â€”â€”å¹¶ä¸ä¸€è‡´ã€‚</p>
<p>å› æ­¤ï¼Œå³ä½¿ KD èƒ½ä½¿åˆ†å¸ƒæ¥è¿‘ï¼Œä¹Ÿä¸ä¸€å®šæå‡ SD çš„å®é™…åŠ é€Ÿæ•ˆæœã€‚</p>
<h3 id="æ ¸å¿ƒé—®é¢˜">æ ¸å¿ƒé—®é¢˜ï¼š<a hidden class="anchor" aria-hidden="true" href="#æ ¸å¿ƒé—®é¢˜">#</a></h3>
<ul>
<li><strong>å®¹é‡å—é™</strong>ï¼šå° draft æ¨¡å‹æ— æ³•è¡¨è¾¾ target çš„å®Œæ•´åˆ†å¸ƒã€‚</li>
<li><strong>ç›®æ ‡ä¸ä¸€è‡´</strong>ï¼šKD ä¼˜åŒ– KLï¼Œè€Œ SD è¿½æ±‚ acceptance rateã€‚</li>
<li><strong>æµªè´¹å­¦ä¹ èµ„æº</strong>ï¼šdraft æŠŠå®¹é‡æµªè´¹åœ¨é‚£äº›â€œæ— è®ºå¦‚ä½•éƒ½éš¾å­¦â€çš„ hard tokens ä¸Šã€‚</li>
</ul>
<hr>
<h2 id="2-challenge">2. Challenge<a hidden class="anchor" aria-hidden="true" href="#2-challenge">#</a></h2>
<p>Conventional KD methods minimize the forward KL divergence between the draft and target models across all tokens:</p>
<p>$$
\mathcal{L}<em>{KD} = \mathbb{E}</em>{x \sim D},[,\mathrm{KL}(P_\text{target}(y|x)|P_\text{draft}(y|x)),]
$$</p>
<p>ç„¶è€Œï¼Œè¿™ç§â€œå¯¹æ‰€æœ‰ token è¿›è¡Œå‡åŒ€è’¸é¦â€çš„ç›®æ ‡å­˜åœ¨ä¸¤å¤§é—®é¢˜ï¼š</p>
<ol>
<li><strong>ä¸ SD ç›®æ ‡ä¸åŒ¹é…</strong>ï¼šSD çš„ç›®æ ‡æ˜¯æœ€å¤§åŒ– acceptance rateï¼Œè€Œä¸æ˜¯å…¨åˆ†å¸ƒ KLã€‚</li>
<li><strong>token å­¦ä¹ éš¾åº¦å·®å¼‚å·¨å¤§</strong>ï¼š
<ul>
<li>â€œeasy tokensâ€ å¯ä»¥è¢«å°æ¨¡å‹å¾ˆå¥½åœ°å­¦ä¹ ï¼›</li>
<li>â€œhard tokensâ€ æ— è®ºæ€ä¹ˆè®­ç»ƒéƒ½éš¾ä»¥å¯¹é½ã€‚</li>
</ul>
</li>
</ol>
<p>å› æ­¤ï¼Œdraft æ¨¡å‹è‹¥åœ¨ hard token ä¸Šæµªè´¹å®¹é‡ï¼Œåè€Œå¯èƒ½æŸå®³ easy token çš„æ‹Ÿåˆè´¨é‡ã€‚</p>
<p><img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/figure2.png"></p>
<hr>
<h2 id="3-contribution">3. Contribution<a hidden class="anchor" aria-hidden="true" href="#3-contribution">#</a></h2>
<p>AdaSPEC çš„æ ¸å¿ƒè´¡çŒ®ï¼š</p>
<ul>
<li><strong>Selective Token Filtering</strong>ï¼šåˆ©ç”¨ reference model è¯†åˆ«å¹¶è¿‡æ»¤æ‰ draft éš¾ä»¥å­¦ä¹ çš„ tokensï¼Œä»…å¯¹â€œæ˜“å­¦ tokenâ€æ‰§è¡Œ KDã€‚</li>
<li><strong>Draft Model èµ„æºå†åˆ†é…</strong>ï¼šä½¿æœ‰é™å®¹é‡ä¸“æ³¨äºå®¹æ˜“æ‹Ÿåˆçš„åŒºåŸŸï¼Œä»è€Œæ˜¾è‘—æå‡ acceptance rateã€‚</li>
<li><strong>å¹¿æ³›éªŒè¯</strong>ï¼šåœ¨ç®—æœ¯æ¨ç†ã€æŒ‡ä»¤è·Ÿéšã€ä»£ç ç”Ÿæˆã€æ‘˜è¦ç”Ÿæˆä»»åŠ¡ä¸Šå‡æ˜¾è‘—ä¼˜äº DistillSpecï¼Œæœ€é«˜æå‡çº¦ 15%ã€‚</li>
</ul>
<hr>
<h2 id="4-method">4. Method<a hidden class="anchor" aria-hidden="true" href="#4-method">#</a></h2>
<p><img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/figure1.png"></p>
<p>AdaSPEC çš„è®­ç»ƒè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªä¸»è¦æ­¥éª¤ï¼š</p>
<h3 id="step-1-constructing-the-reference-model">Step 1: Constructing the Reference Model<a hidden class="anchor" aria-hidden="true" href="#step-1-constructing-the-reference-model">#</a></h3>
<ol>
<li><strong>åˆå§‹åŒ–</strong>ï¼šä»¥ draft æ¨¡å‹ç»“æ„ä¸ºåŸºç¡€ï¼Œå¤åˆ¶å…¶å‚æ•°å¾—åˆ° reference model ( M_{\text{ref}} )ã€‚</li>
<li><strong>è’¸é¦è®­ç»ƒ</strong>ï¼šåˆ©ç”¨ target æ¨¡å‹ ( M_{\text{tgt}} ) ä½œä¸º teacherï¼Œå¯¹ reference model è¿›è¡Œå¸¸è§„ KDï¼š
$$
\mathcal{L}<em>{ref} = \mathbb{E}\big[\mathrm{KL}(P</em>{\text{tgt}}(y|x)|P_{\text{ref}}(y|x))\big]
$$</li>
<li><strong>ç›®æ ‡</strong>ï¼šå¾—åˆ°ä¸€ä¸ªå¯¹ target è¡Œä¸ºè¾ƒå¥½æ‹Ÿåˆã€ä½†å®¹é‡ä»æ¥è¿‘ draft çš„ reference æ¨¡å‹ï¼Œç”¨äºè¡¡é‡ token éš¾åº¦ã€‚</li>
</ol>
<hr>
<h3 id="step-2-selective-knowledge-distillation-for-the-draft-model">Step 2: Selective Knowledge Distillation for the Draft Model<a hidden class="anchor" aria-hidden="true" href="#step-2-selective-knowledge-distillation-for-the-draft-model">#</a></h3>
<p>åœ¨è®­ç»ƒ draft æ¨¡å‹ ( M_q ) æ—¶ï¼Œå¼•å…¥ selective token filteringï¼š</p>
<ol>
<li>
<p><strong>å®šä¹‰ token-wise loss å·®å€¼ï¼š</strong></p>
<p>å¯¹äºæ¯ä¸ª token ( w )ï¼Œè®¡ç®— draft ä¸ reference åœ¨ç›¸å¯¹äº target çš„ KL æŸå¤±ï¼š
$$
L_{ref}(w) = \mathrm{KL}(P_{\text{tgt}}(w|x)|P_{\text{ref}}(w|x))
$$
$$
L_{draft}(w) = \mathrm{KL}(P_{\text{tgt}}(w|x)|P_{\text{draft}}(w|x))
$$</p>
<p>å®šä¹‰å·®å€¼ï¼š
$$
\Delta L(w) = L_{draft}(w) - L_{ref}(w)
$$</p>
</li>
<li>
<p><strong>token é€‰æ‹©ï¼ˆFilteringï¼‰</strong>ï¼š</p>
<p>è®¡ç®—æ¯ä¸ª token çš„ Î”Lï¼Œå¹¶æŒ‰å€¼æ’åºï¼Œä»…ä¿ç•™ top-k%ï¼ˆä¾‹å¦‚ 40%ï¼‰çš„ token å‚ä¸è’¸é¦ï¼š
$$
S = { w \mid \Delta L(w) \text{ ä½äºå‰ } k% }
$$</p>
<p>ç›´è§‰ï¼š</p>
<ul>
<li>è‹¥ Î”L è¾ƒå¤§ â†’ draft å¯¹è¯¥ token ä»æœ‰æ”¹è¿›ç©ºé—´ï¼Œå€¼å¾—å­¦ä¹ ï¼›</li>
<li>è‹¥ Î”L è¾ƒå°æˆ–è´Ÿ â†’ token å¤ªéš¾æˆ– draft/ref éƒ½å­¦ä¸å¥½ï¼Œæ— éœ€æµªè´¹å®¹é‡ã€‚</li>
</ul>
</li>
<li>
<p><strong>æœ€ç»ˆçš„ selective distillation lossï¼š</strong></p>
<p>ä»…å¯¹é€‰ä¸­çš„ token æ±‚å¹³å‡ï¼š
$$
\mathcal{L}<em>{AdaSPEC} = \frac{1}{|S|}\sum</em>{w \in S} L_{draft}(w)
$$</p>
</li>
</ol>
<hr>
<h2 id="5-evaluation">5. Evaluation<a hidden class="anchor" aria-hidden="true" href="#5-evaluation">#</a></h2>
<h3 id="51-å®éªŒè®¾ç½®">5.1 å®éªŒè®¾ç½®<a hidden class="anchor" aria-hidden="true" href="#51-å®éªŒè®¾ç½®">#</a></h3>
<ul>
<li>
<p><strong>Datasets / Tasks</strong>ï¼š</p>
<ul>
<li>Arithmetic reasoning (GSM8K)</li>
<li>Instruction-following (Alpaca)</li>
<li>Coding (MBPP)</li>
<li>Summarization (CNN/DM, XSUM)</li>
</ul>
</li>
<li>
<p><strong>Model pairs</strong>ï¼š</p>
<ul>
<li>Pythia-31M â†’ 1.4B</li>
<li>CodeGen-350M â†’ Phi-2 (2.7B)</li>
<li>Phi-1.5 â†’ Phi-2</li>
<li>Mixtral-8x7B â†’ Mixtral-8x22B</li>
</ul>
</li>
<li>
<p><strong>Baselines</strong>ï¼š</p>
<ul>
<li>Direct KD</li>
<li>DistillSpec</li>
<li>RKL-based distillation</li>
<li>Token filtering ablations (ä¸åŒ filter é˜ˆå€¼)</li>
</ul>
</li>
<li>
<p><strong>Metrics</strong>ï¼š</p>
<ul>
<li>Token acceptance rate (â†‘)</li>
<li>Task accuracy (e.g. pass@1, rouge-L)</li>
<li>Speed-up ratio (â†‘)</li>
<li>Draft perplexity vs. target perplexity</li>
</ul>
</li>
</ul>
<hr>
<h3 id="52-ä¸»è¦ç»“æœ">5.2 ä¸»è¦ç»“æœ<a hidden class="anchor" aria-hidden="true" href="#52-ä¸»è¦ç»“æœ">#</a></h3>
<p><img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/table1.png">
<img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/figure3.png"></p>
<ol>
<li>
<p><strong>Acceptance Rate æ˜¾è‘—æå‡</strong></p>
<ul>
<li>å¹³å‡æå‡ 8â€“15%ï¼›</li>
<li>åœ¨ 31M â†’ 1.4B çš„æå¤§è§„æ¨¡å·®ä¸‹æ•ˆæœæœ€çªå‡ºï¼›</li>
<li>å³ä½¿åœ¨ capacity gap è¾¾ 64Ã— çš„æƒ…å†µä¸‹ï¼Œä»ç»´æŒé«˜ acceptance rateã€‚</li>
</ul>
</li>
<li>
<p><strong>Generation Quality æ— æ˜æ˜¾ä¸‹é™</strong></p>
<ul>
<li>Rouge-Lã€BLEUã€pass@1 ç­‰æŒ‡æ ‡å‡ ä¹ä¿æŒï¼›</li>
<li>selective filtering å¹¶æœªå¯¼è‡´è¯­ä¹‰åç§»æˆ–å¥æ³•å¼‚å¸¸ã€‚</li>
</ul>
</li>
</ol>
<p><img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/table234.png">
<img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/table5.png"></p>
<ol start="3">
<li>
<p><strong>Token Filtering çš„æ¯”ä¾‹å½±å“</strong></p>
<ul>
<li>è®ºæ–‡å®éªŒæ˜¾ç¤ºå½“è¿‡æ»¤æ¯”ä¾‹åœ¨ 30â€“50% æ—¶æ€§èƒ½æœ€ä¼˜ï¼›</li>
<li>è¿‡æ»¤è¿‡å¤šï¼ˆ&lt;20%ï¼‰å¯¼è‡´ä¿¡æ¯ä¸è¶³ï¼Œè¿‡æ»¤è¿‡å°‘ï¼ˆ&gt;60%ï¼‰åˆ™æµªè´¹å®¹é‡ã€‚</li>
</ul>
</li>
</ol>
<p><img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/table67.png">
<img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/table8.png"></p>
<ol start="4">
<li>
<p><strong>Wall-Time Speed-up</strong></p>
<ul>
<li>åœ¨ vLLM å®æµ‹ä¸‹å¯è¾¾ 1.2â€“1.4Ã— åŠ é€Ÿï¼›</li>
<li>ä¸ EAGLE ç­‰ speculative sampling ç­–ç•¥ç»“åˆå¯è¿›ä¸€æ­¥æå‡ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h3 id="53-æ¶ˆèç ”ç©¶ablation">5.3 æ¶ˆèç ”ç©¶ï¼ˆAblationï¼‰<a hidden class="anchor" aria-hidden="true" href="#53-æ¶ˆèç ”ç©¶ablation">#</a></h3>
<p><img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/table5.png"></p>
<ul>
<li><strong>æ— è¿‡æ»¤ï¼ˆFull KDï¼‰</strong>ï¼šacceptance rate æœ€ä½ï¼›</li>
<li><strong>éšæœºè¿‡æ»¤</strong>ï¼šæ— è§„å¾‹æ€§èƒ½ä¸‹é™ï¼›</li>
<li><strong>AdaSPEC Filtering</strong>ï¼šåœ¨ç›¸åŒ loss ä¸‹å¯æ˜¾è‘—æå‡ Î±ï¼›</li>
<li><strong>ä¸åŒ KD æŸå¤±ï¼ˆRKL / TVDï¼‰</strong>ï¼šforward KL è¡¨ç°æœ€ç¨³å®šã€‚</li>
</ul>
<hr>
<h2 id="6-discussion">6. Discussion<a hidden class="anchor" aria-hidden="true" href="#6-discussion">#</a></h2>
<h3 id="61-size-gap-between-target-and-draft-models">6.1 Size Gap Between Target and Draft Models<a hidden class="anchor" aria-hidden="true" href="#61-size-gap-between-target-and-draft-models">#</a></h3>
<p>è®ºæ–‡æŒ‡å‡ºï¼Œåœ¨ä¼ ç»Ÿ SD ä¸­ï¼Œdraft ä¸ target çš„è§„æ¨¡å·®ä¸€èˆ¬ &lt;10Ã—ã€‚
ä½† AdaSPEC é€šè¿‡ selective KDï¼Œå³ä½¿åœ¨ <strong>64Ã— å‚æ•°å·®è·</strong>ä¸‹ä»ä¿æŒæ˜¾è‘—æ€§èƒ½æå‡ã€‚</p>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li>å½“æ¨¡å‹å®¹é‡å·®è·æ‰©å¤§æ—¶ï¼Œç›´æ¥ KD çš„â€œrepresentation mismatchâ€é—®é¢˜æ›´ä¸¥é‡ï¼›</li>
<li>AdaSPEC é€šè¿‡èšç„¦äºæ˜“å­¦ tokenï¼Œå‡å°‘äº† mismatch åŒºåŸŸï¼›</li>
<li>å› æ­¤æ¨¡å‹å·®è·è¶Šå¤§ï¼ŒAdaSPEC çš„ç›¸å¯¹æ”¶ç›Šè¶Šæ˜æ˜¾ã€‚</li>
</ul>
<hr>
<h3 id="62-ä¸-rho-1-çš„å…³ç³»lin-et-al-2024">6.2 ä¸ Rho-1 çš„å…³ç³»ï¼ˆLin et al., 2024ï¼‰<a hidden class="anchor" aria-hidden="true" href="#62-ä¸-rho-1-çš„å…³ç³»lin-et-al-2024">#</a></h3>
<ul>
<li>
<p>Rho-1 (<em>Not All Tokens Are What You Need</em>) å¼ºè°ƒåœ¨é¢„è®­ç»ƒé˜¶æ®µ <strong>ä¼˜å…ˆå­¦ä¹  hard tokens</strong>ï¼›</p>
</li>
<li>
<p>AdaSPEC åˆ™ç›¸åï¼šåœ¨ SD ä¸­ <strong>æ’é™¤ hard tokens</strong>ï¼Œèšç„¦äºæ˜“å­¦éƒ¨åˆ†ï¼›</p>
</li>
<li>
<p>åŒºåˆ«æºäºç›®æ ‡ä¸åŒï¼š</p>
<ul>
<li>é¢„è®­ç»ƒå¸Œæœ›æ‰©å±•æ¨¡å‹èƒ½åŠ›ï¼›</li>
<li>SD è’¸é¦å¸Œæœ›æœ€å¤§åŒ–å°æ¨¡å‹çš„å®ç”¨æ€§èƒ½ï¼ˆacceptance rateï¼‰ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h3 id="63-å±€é™æ€§ä¸æœªæ¥æ–¹å‘">6.3 å±€é™æ€§ä¸æœªæ¥æ–¹å‘<a hidden class="anchor" aria-hidden="true" href="#63-å±€é™æ€§ä¸æœªæ¥æ–¹å‘">#</a></h3>
<blockquote>
<p>â€œAs a preliminary study on selective training for SD, we limit our study on simple loss-related token filter.â€</p>
</blockquote>
<ul>
<li>
<p>future work:</p>
<ul>
<li>ä¸ tree-based speculative decoding (å¦‚ MoSD) ç»“åˆ</li>
</ul>
</li>
</ul>
<hr>
<h2 id="7-conclusion">7. Conclusion<a hidden class="anchor" aria-hidden="true" href="#7-conclusion">#</a></h2>
<p>We present <strong>AdaSPEC</strong>, a novel approach for training more efficient draft models for Speculative Decoding.
AdaSPEC introduces <strong>selective token filtering</strong> based on reference model perplexity gaps, enabling draft models to focus limited capacity on tokens where alignment with the target model is most achievable.</p>
<ul>
<li><strong>Higher acceptance rates</strong> across diverse tasks;</li>
<li><strong>Significant acceleration</strong> without degradation in output quality;</li>
<li><strong>Robustness</strong> across large model gaps.</li>
</ul>
<p><img loading="lazy" src="https://jjl357.github.io/blog/image/AdaSpec/table8.png"></p>
<blockquote>
<p>AdaSPEC ä¸ºå°æ¨¡å‹çš„é«˜æ•ˆæ¨ç†ï¼ˆå°¤å…¶æ˜¯åœ¨ edge / on-device åœºæ™¯ï¼‰æä¾›äº†æ–°çš„è’¸é¦è§†è§’ã€‚
å®ƒå¯å‘æˆ‘ä»¬ï¼š<strong>åœ¨æ¨ç†åŠ é€Ÿä»»åŠ¡ä¸­ï¼Œå­¦ä¹ ä»€ä¹ˆæ¯”å­¦å¤šå°‘æ›´é‡è¦ã€‚</strong></p>
</blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://jjl357.github.io/blog/tags/speculative-decoding/">Speculative Decoding</a></li>
      <li><a href="https://jjl357.github.io/blog/tags/paper-note/">Paper Note</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://jjl357.github.io/blog/">JJ&#39;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
